---
phase: 11-gui-epistemic-reader-knowledge
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - gui/index.html
  - gui/js/components/narrative-tree-editor.js
autonomous: true
gap_closure: true
must_haves:
  truths:
    - "User can track which facts are revealed to the reader in each scene"
    - "User can see dramatic irony warnings when characters act on incomplete knowledge"
    - "User can edit scenes with reader knowledge section"
  artifacts:
    - path: "gui/index.html"
      provides: "Script tags for Phase 11 components"
      contains: "reader-knowledge-tracker.js"
    - path: "gui/js/components/narrative-tree-editor.js"
      provides: "Scene click handler to open scene editor"
      contains: "SceneEditor.init"
  key_links:
    - from: "gui/index.html"
      to: "reader-knowledge-tracker.js"
      via: "script tag loads component"
      pattern: "reader-knowledge-tracker\\.js"
    - from: "gui/index.html"
      to: "dramatic-irony-panel.js"
      via: "script tag loads component"
      pattern: "dramatic-irony-panel\\.js"
    - from: "gui/index.html"
      to: "scene-editor.js"
      via: "script tag loads component"
      pattern: "scene-editor\\.js"
    - from: "narrative-tree-editor.js"
      to: "SceneEditor"
      via: "scene click handler"
      pattern: "SceneEditor\\.init"
---

<objective>
Wire Phase 11 components into index.html and connect scene editor to narrative screen.

Purpose: Close verification gaps - components are implemented but not loaded in browser, and scene editor has no way to be opened by users.
Output: Working reader knowledge tracking and scene editing from narrative screen.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Verification gaps from 11-VERIFICATION.md:
**Gap 1:** reader-knowledge-tracker.js, dramatic-irony-panel.js, scene-editor.js created but not in index.html
**Gap 2:** SceneEditor exists but no click handler to open it from narrative screen
**Gap 3:** Component dependency order - SceneEditor depends on ReaderKnowledgeTracker and DramaticIronyPanel

# What's already built (from 11-01-SUMMARY.md):
- gui/js/components/reader-knowledge-tracker.js (221 lines) - tracks facts revealed to reader
- gui/js/components/dramatic-irony-panel.js (368 lines) - compares reader vs character knowledge
- gui/js/components/scene-editor.js (340 lines) - full modal with epistemic sections

# Current state:
@gui/index.html
@gui/js/components/narrative-tree-editor.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Load Phase 11 components in index.html</name>
  <files>gui/index.html</files>
  <action>
Add three script tags before narrative-tree-editor.js (line 46), in dependency order:
1. reader-knowledge-tracker.js (no dependencies)
2. dramatic-irony-panel.js (depends on reader-knowledge-tracker)
3. scene-editor.js (depends on both above)

Insert after line 45 (causality-graph.js), before line 46 (narrative-tree-editor.js):
```html
  <script src="/js/components/reader-knowledge-tracker.js"></script>
  <script src="/js/components/dramatic-irony-panel.js"></script>
  <script src="/js/components/scene-editor.js"></script>
```

Do NOT change any existing script order. SceneEditor must be loaded before screens that might use it.
  </action>
  <verify>grep "reader-knowledge-tracker.js" gui/index.html && grep "dramatic-irony-panel.js" gui/index.html && grep "scene-editor.js" gui/index.html</verify>
  <done>Three script tags added in correct dependency order between causality-graph.js and narrative-tree-editor.js</done>
</task>

<task type="auto">
  <name>Task 2: Wire scene editor to narrative tree scene clicks</name>
  <files>gui/js/components/narrative-tree-editor.js</files>
  <action>
Add scene click handler in the scene card rendering section. Find where scene cards are created (around line 180-200 where scene HTML is built) and add click event handler to open SceneEditor.

Pattern to follow:
1. Scene cards should be clickable (cursor: pointer)
2. Click handler calls `SceneEditor.init(sceneId)`
3. Use event delegation on parent container if scenes are in data-scene-id attributes

Likely around renderChapterContent or renderUnassignedScenes where scene divs are created. Add:
- CSS class for clickable scenes (or inline style cursor:pointer)
- Event listener: `sceneCard.addEventListener('click', () => SceneEditor.init(scene.scene_id))`

Alternatively, if scene divs have data-scene-id attribute, use event delegation on .narrative-tree-container:
```javascript
container.addEventListener('click', (e) => {
  const sceneCard = e.target.closest('[data-scene-id]');
  if (sceneCard) {
    const sceneId = sceneCard.dataset.sceneId;
    SceneEditor.init(sceneId);
  }
});
```

Choose the approach that matches existing code patterns in narrative-tree-editor.js.
  </action>
  <verify>grep -A5 "SceneEditor.init" gui/js/components/narrative-tree-editor.js</verify>
  <done>Scene cards clickable, clicking opens SceneEditor with scene ID</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All three script tags present in index.html
- [ ] Script tags in correct order (reader-knowledge-tracker → dramatic-irony-panel → scene-editor)
- [ ] Scene click handler added to narrative-tree-editor.js
- [ ] Handler calls SceneEditor.init(sceneId)
</verification>

<success_criteria>

- Script tags added to index.html for all Phase 11 components
- Components load in correct dependency order
- Scene click handler integrated into narrative-tree-editor.js
- Verification gaps closed: components accessible in browser, scene editor can be opened
  </success_criteria>

<output>
After completion, create `.planning/phases/11-gui-epistemic-reader-knowledge/11-04-SUMMARY.md`
</output>
