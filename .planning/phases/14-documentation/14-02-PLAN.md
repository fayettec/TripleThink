---
phase: 14-documentation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [API_DOCUMENTATION.md, USAGE_MANUAL_v4.1.md, MIGRATION_GUIDE.md]
autonomous: true

must_haves:
  truths:
    - "Users can find API documentation for all logic layer endpoints"
    - "Users can understand QACS workflow and how to use v4.1 features"
    - "v1.0 users understand migration path"
  artifacts:
    - path: "API_DOCUMENTATION.md"
      provides: "Complete API reference for all endpoints"
      min_lines: 600
      contains: "/api/logic"
    - path: "USAGE_MANUAL_v4.1.md"
      provides: "Updated usage manual with v4.1 features"
      exports: ["QACS workflow"]
      contains: "Query-Assemble-Context-Supply"
    - path: "MIGRATION_GUIDE.md"
      provides: "Migration guidance for v1.0 users"
      min_lines: 50
      contains: "fresh start"
  key_links:
    - from: "API_DOCUMENTATION.md"
      to: "api/routes/"
      via: "documents actual endpoints"
      pattern: "/api/"
    - from: "USAGE_MANUAL_v4.1.md"
      to: "api/services/orchestrator.js"
      via: "explains QACS workflow"
      pattern: "orchestrator"
---

<objective>
Create comprehensive API documentation and update usage manual with v4.1 features.

Purpose: Enable users to understand all API endpoints and QACS workflow for zero-knowledge scene generation.
Output: API_DOCUMENTATION.md, updated USAGE_MANUAL_v4.1.md, and MIGRATION_GUIDE.md.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Codebase context
@.planning/codebase/STRUCTURE.md
@.planning/codebase/CONVENTIONS.md

# API routes built in Phases 1-7
@api/routes/entities.js
@api/routes/epistemic.js
@api/routes/temporal.js
@api/routes/fictions.js
@api/routes/projects.js
@api/routes/moments.js
@api/routes/logic-layer.js
@api/routes/validation.js
@api/routes/state.js
@api/routes/orchestrator.js
@api/routes/export.js
@api/routes/search.js

# Orchestrator service (QACS workflow)
@api/services/orchestrator.js

# Existing usage manual to update
@USAGE_MANUAL_v4.1.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API_DOCUMENTATION.md</name>
  <files>API_DOCUMENTATION.md</files>
  <action>
    Create comprehensive API documentation for all endpoints.

    Structure:
    1. Introduction
       - Base URL: http://localhost:3000
       - Authentication: Optional API key (TRIPLETHINK_API_KEY)
       - Response format: JSON with { data } or { error }
       - Error codes and meanings

    2. Core Data Endpoints
       - POST /api/entities - Create entity
       - GET /api/entities/:id - Get entity
       - PUT /api/entities/:id - Update entity
       - DELETE /api/entities/:id - Delete entity
       - GET /api/entities - List entities (with filters)

    3. Project & Fiction Management
       - /api/projects/* - Project CRUD
       - /api/fictions/* - Fiction CRUD

    4. Temporal Endpoints
       - GET /api/temporal/state/:timestamp - Get state at timestamp
       - POST /api/state/snapshots - Create snapshot
       - GET /api/state/deltas - Get deltas

    5. Epistemic Endpoints
       - POST /api/epistemic/facts - Add knowledge fact
       - GET /api/epistemic/facts/:entityId/:timestamp - Get knowledge state
       - GET /api/epistemic/compare - Compare knowledge states

    6. Logic Layer Endpoints (Phase 7)
       - /api/logic/causality/* - Causality chains CRUD
       - GET /api/logic/causality/chain/:eventId?depth=3 - Traverse causal chain
       - /api/logic/arcs/* - Character arcs CRUD
       - POST /api/logic/arcs/:id/advance - Advance arc phase
       - /api/logic/conflicts/* - Story conflicts CRUD
       - POST /api/logic/conflicts/:id/transition - Transition conflict status
       - /api/logic/themes/* - Thematic elements CRUD
       - /api/logic/motifs/* - Motif instances CRUD
       - /api/logic/setup-payoffs/* - Setup/payoffs CRUD
       - GET /api/logic/setup-payoffs/unfired - Get unfired setups
       - /api/logic/world-rules/* - World rules CRUD

    7. Validation Endpoints (Phase 13)
       - POST /api/validation/run - Run validation rules
       - GET /api/validation/results - Get validation results

    8. Orchestrator Endpoint (QACS)
       - POST /api/orchestrator/context - Assemble context packet for scene

    9. Search & Export
       - GET /api/search - Search entities
       - POST /api/export - Export data

    For each endpoint:
    - Method and path
    - Request parameters (path, query, body)
    - Response format with example
    - Error codes specific to endpoint
    - Usage example with curl

    Reference actual route implementations. Extract real parameter names and response structures from code.
  </action>
  <verify>API_DOCUMENTATION.md exists, documents all 50+ endpoints with examples</verify>
  <done>API documentation complete with all endpoints, parameters, responses, and curl examples</done>
</task>

<task type="auto">
  <name>Task 2: Update USAGE_MANUAL_v4.1.md</name>
  <files>USAGE_MANUAL_v4.1.md</files>
  <action>
    Update existing USAGE_MANUAL_v4.1.md with v4.1 features and QACS workflow.

    Read existing manual first, then add/update sections:

    1. Update "Current Status" to reflect Phase 13 Complete (all phases done)

    2. Add "Logic Layer" section to Architecture Overview:
       - What is the Logic Layer (causality, arcs, conflicts, themes, motifs, setups, rules)
       - Why it matters (enables AI to understand story structure)
       - How it integrates with Foundation and Hybrid State layers

    3. Add "QACS Workflow" section:
       - What is QACS (Query-Assemble-Context-Supply)
       - How orchestrator assembles zero-knowledge context packets
       - What's included in context packet (entities, knowledge states, arcs, conflicts, themes)
       - Example: Assembling context for scene with 3 characters
       - API usage: POST /api/orchestrator/context

    4. Add "GUI Features" section:
       - Story Logic screen (6 tabs)
       - Narrative editor (drag-and-drop)
       - Epistemic enhancements (reader knowledge, dramatic irony)
       - Advanced features (relationship map, dashboard stats)
       - Layer switching (World Truth, Character View, Reader View)

    5. Add "Validation System" section:
       - 106 validation rules across 8 categories
       - How to run validation (API or GUI)
       - Understanding validation results
       - Severity levels (critical, error, warning)

    6. Update "Getting Started" with GUI access:
       - API: http://localhost:3000
       - GUI: http://localhost:8080
       - Basic workflow: Create project → Add entities → Track story structure → Assemble context

    7. Add "Performance Notes" section:
       - State reconstruction <100ms for 100-delta chains
       - Context assembly <1s for 10-character scenes
       - Storage <50MB for 10-book series

    Preserve existing content where still accurate. Focus on adding v4.1 capabilities.
  </action>
  <verify>USAGE_MANUAL_v4.1.md updated, contains QACS workflow, Logic Layer, GUI features, validation system</verify>
  <done>Usage manual updated with all v4.1 features, QACS workflow explained, examples provided</done>
</task>

<task type="auto">
  <name>Task 3: Create MIGRATION_GUIDE.md</name>
  <files>MIGRATION_GUIDE.md</files>
  <action>
    Create migration guide for v1.0 users.

    Content:
    1. Introduction
       - TripleThink v4.1 is a complete rewrite
       - Previous "version 1" codebase isolated/contaminated by YOLO mode
       - No automated migration path

    2. Migration Strategy: Fresh Start
       - Export data from v1.0 if possible (export endpoints may not exist)
       - Manually recreate project structure in v4.1
       - Re-enter entities, events, knowledge states
       - Why: v4.1 schema fundamentally different (hybrid state, logic layer)

    3. What's New in v4.1
       - Hybrid state system (snapshots + deltas)
       - Logic layer (causality, arcs, conflicts, themes, motifs, setups, rules)
       - GUI with drag-and-drop narrative editing
       - QACS orchestrator for AI context assembly
       - 106 validation rules
       - Performance improvements (<100ms state reconstruction)

    4. What's Different
       - Database schema changed (16 tables vs 8)
       - API endpoints reorganized (/api/logic/*, /api/orchestrator/*)
       - GUI redesigned (SPA with screens)
       - Event sourcing with snapshots (not pure append-only)

    5. Migration Checklist
       - [ ] Review v4.1 documentation
       - [ ] Install v4.1 (npm install, init-database.js)
       - [ ] Create project structure (fictions, acts, chapters)
       - [ ] Re-enter entities (characters, locations, objects, systems)
       - [ ] Re-enter events with timestamps
       - [ ] Add knowledge states (epistemic facts)
       - [ ] Define story structure (arcs, conflicts, themes)
       - [ ] Validate with validation system

    6. Support
       - If you have critical v1.0 data that must be migrated, open GitHub issue
       - Community may develop migration scripts

    Be honest: v4.1 is a fresh start, no easy migration. Acknowledge inconvenience, explain benefits justify restart.
  </action>
  <verify>MIGRATION_GUIDE.md exists, explains fresh start requirement, provides migration checklist</verify>
  <done>Migration guide complete explaining v4.1 as fresh start with checklist and reasoning</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] API_DOCUMENTATION.md exists with 50+ endpoint documentation
- [ ] USAGE_MANUAL_v4.1.md updated with v4.1 features and QACS workflow
- [ ] MIGRATION_GUIDE.md created explaining fresh start
- [ ] All documents reference actual code and endpoints
- [ ] Curl examples work with actual API
- [ ] Markdown formatting is valid
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- API documentation complete for all endpoints
- Usage manual updated with v4.1 features
- Migration guide explains fresh start requirement
- Documentation accurate and references real code
</success_criteria>

<output>
After completion, create `.planning/phases/14-documentation/14-02-SUMMARY.md`
</output>
