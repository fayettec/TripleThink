---
phase: 12-gui-advanced-features
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [gui/js/screens/validation.js, gui/js/screens/timeline.js, gui/index.html, gui/js/app.js, gui/css/components.css]
autonomous: true

must_haves:
  truths:
    - "User can access SQL query window placeholder labeled 'Coming Soon'"
    - "User can view validation results organized by category tabs"
    - "User can see state reconstruction indicators on timeline (snapshot anchors, delta symbols)"
  artifacts:
    - path: "gui/js/screens/validation.js"
      provides: "Validation results screen with 8 category tabs"
      min_lines: 150
    - path: "gui/js/screens/timeline.js"
      provides: "Timeline with state reconstruction indicators"
      contains: "snapshot-anchor"
  key_links:
    - from: "validation.js"
      to: "/api/validation"
      via: "fetches validation results"
      pattern: "api/validation"
    - from: "timeline.js"
      to: "snapshot/delta rendering"
      via: "displays reconstruction indicators"
      pattern: "snapshot-anchor|delta-symbol"
---

<objective>
Create validation results screen with category tabs, add SQL query placeholder, and enhance timeline with state reconstruction indicators.

Purpose: Validation screen organizes 100+ validation rules by category for easier review. SQL placeholder reserves space for future power-user feature. Timeline indicators show snapshot anchors and delta chains for understanding state reconstruction performance.

Output: Validation screen with 8 tabs, SQL query placeholder UI, timeline visualization enhancements.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries
@.planning/phases/11-gui-epistemic-reader-knowledge/11-04-SUMMARY.md
@.planning/phases/09-gui-logic-visualization/09-01-SUMMARY.md

# Existing patterns
@gui/js/screens/story-logic.js
@gui/js/screens/timeline.js
@gui/css/components.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create validation.js screen with 8 category tabs</name>
  <files>gui/js/screens/validation.js</files>
  <action>
Create validation results screen following story-logic.js tab pattern.

Structure:
- ValidationScreen object with async render() method
- Screen header with title "Validation" and power drawer button
- 8 tabs matching Phase 13 validation categories:
  1. Epistemic (knowledge consistency)
  2. Causality (cause-effect chains)
  3. Arcs (character transformation)
  4. Conflicts (story tension)
  5. Setup/Payoffs (Chekhov's guns)
  6. World Rules (universe consistency)
  7. Narrative (structure, pacing)
  8. Performance (benchmarks)

- Tab structure similar to story-logic.js:
  - Tab bar with clickable tab buttons
  - Active tab highlighted
  - Tab content area showing validation results for selected category
  - state.subscribe('activeTab') for persistence

- Each tab content section:
  - Fetch validation results: api.request('/api/validation') returns array with category field
  - Filter results by category (category === 'epistemic', etc.)
  - Display results as cards: rule_id, severity (error/warning/info), message, artifact (file path if applicable)
  - Color-code by severity: red (error), orange (warning), blue (info)
  - Show "All checks passed âœ“" if no results for category

- Empty state: "No project selected" if !state.currentProjectId
- Loading state: "Running validation..." spinner while fetching

Why 8 categories: Matches Phase 13 validation service structure (VAL-02 requirement). Organizing by category makes 100+ rules manageable.
  </action>
  <verify>grep -q "Epistemic\|Causality\|Arcs\|Conflicts" gui/js/screens/validation.js && grep -q "api.request('/api/validation')" gui/js/screens/validation.js</verify>
  <done>validation.js exists, has 8 tabs, fetches validation results, displays categorized results with severity colors</done>
</task>

<task type="auto">
  <name>Task 2: Add SQL query window placeholder</name>
  <files>gui/js/screens/validation.js</files>
  <action>
Add SQL query placeholder section below validation results in ValidationScreen.

Structure (at bottom of screen content, after validation tabs):
```html
<div class="sql-placeholder">
  <div class="placeholder-icon">ðŸ’¡</div>
  <h3>SQL Query Window</h3>
  <p>Coming Soon - Power User Feature</p>
  <p class="placeholder-hint">Direct database queries for advanced analysis and custom reports.</p>
  <button class="btn btn-secondary" disabled>Launch SQL Editor</button>
</div>
```

CSS styling (add to gui/css/components.css):
```css
.sql-placeholder {
  margin-top: 40px;
  padding: 40px;
  text-align: center;
  background-color: var(--color-surface-light);
  border: 2px dashed var(--color-border);
  border-radius: 8px;
}

.sql-placeholder .placeholder-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.sql-placeholder h3 {
  margin: 0 0 8px 0;
  color: var(--color-text);
}

.sql-placeholder p {
  margin: 4px 0;
  color: var(--color-text-secondary);
}

.sql-placeholder .placeholder-hint {
  font-size: 0.9em;
  font-style: italic;
}

.sql-placeholder button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
```

Why placeholder: Reserves UI space for Phase 14+ feature. Shows users the roadmap without promising immediate delivery. Disabled button prevents confusion.
  </action>
  <verify>grep -q "sql-placeholder\|Coming Soon" gui/js/screens/validation.js && grep -q "sql-placeholder" gui/css/components.css</verify>
  <done>SQL placeholder added to validation screen with "Coming Soon" label, styled, button disabled</done>
</task>

<task type="auto">
  <name>Task 3: Enhance timeline.js with state reconstruction indicators</name>
  <files>gui/js/screens/timeline.js, gui/css/components.css</files>
  <action>
Add snapshot anchors and delta symbols to timeline visualization.

State reconstruction context:
- Hybrid state architecture (Phase 1, STATE.md decision): Snapshots created periodically (every N events) + deltas between snapshots
- Snapshots = full state captures (anchor points for fast reconstruction)
- Deltas = incremental changes between snapshots
- Performance target: <100ms reconstruction for 100-delta chains

Visual indicators (add to timeline event cards):
1. **Snapshot Anchor** (for events that trigger snapshots):
   - Add anchor icon ðŸ“ or âš“ to event card top-right corner
   - Tooltip: "State Snapshot - Full state capture at this point"
   - Determine if event is snapshot: event.sequence_index % 10 === 0 (snapshot every 10 events - heuristic)
   - Visual: Gold/yellow badge with anchor icon

2. **Delta Symbol** (for events that are deltas):
   - Add delta icon Î” to event card top-right corner (most events)
   - Tooltip: "Delta Event - Incremental change since last snapshot"
   - Visual: Small gray badge with Î” symbol
   - Only show if event is NOT a snapshot

3. **Delta Chain Indicator**:
   - For events, show "distance from last snapshot" as number in badge
   - E.g., "Î”3" means 3 deltas since last snapshot
   - Calculate: event.sequence_index % 10 (0-9)

Implementation in timeline.js:
- Modify renderEventCard() method (or equivalent rendering function)
- Add indicator badges to card header alongside timestamp
- Use inline styling or add classes: .snapshot-anchor, .delta-symbol

CSS (add to components.css):
```css
.snapshot-anchor {
  display: inline-block;
  padding: 2px 6px;
  background-color: #f39c12;
  color: white;
  border-radius: 4px;
  font-size: 0.8em;
  margin-left: 8px;
}

.delta-symbol {
  display: inline-block;
  padding: 2px 6px;
  background-color: var(--color-border);
  color: var(--color-text-secondary);
  border-radius: 4px;
  font-size: 0.8em;
  margin-left: 8px;
}
```

Why these indicators: Helps users understand state reconstruction behavior. Gold snapshots show "anchor points" where full state exists. Delta chains show how many changes since last anchor. Relevant for performance debugging in Phase 13.
  </action>
  <verify>grep -q "snapshot-anchor\|delta-symbol" gui/js/screens/timeline.js && grep -q "snapshot-anchor\|delta-symbol" gui/css/components.css</verify>
  <done>Timeline displays snapshot anchors (gold badges), delta symbols (gray badges), and chain distance indicators</done>
</task>

<task type="auto">
  <name>Task 4: Register validation screen in router and add navigation</name>
  <files>gui/js/app.js, gui/index.html</files>
  <action>
1. Load validation.js screen in gui/index.html scripts section (after dashboard.js):
   ```html
   <script src="/js/screens/validation.js"></script>
   ```

2. Register validation route in gui/js/app.js (after dashboard line):
   ```javascript
   Router.register('validation', ValidationScreen);
   ```

3. Add nav link to sidebar in gui/index.html (add after Story Logic link, near bottom of nav):
   ```html
   <a href="#validation" class="nav-link" data-route="validation">
     <span class="nav-icon">âœ“</span>
     <span class="nav-label">Validation</span>
   </a>
   ```

Why validation in nav: Validation is a primary workflow for story health checking. Placing near bottom (after content screens, before settings-type screens) groups it with utility features.
  </action>
  <verify>grep -q "validation.js" gui/index.html && grep -q "Router.register('validation'" gui/js/app.js && grep -q "data-route=\"validation\"" gui/index.html</verify>
  <done>Validation screen loaded, registered in router, nav link added</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Validation screen renders with 8 tabs
- [ ] SQL placeholder shows "Coming Soon - Power User Feature"
- [ ] Timeline shows snapshot anchor and delta symbol indicators
- [ ] Validation registered in router and accessible via navigation
- [ ] All CSS styling applied correctly
- [ ] No console errors when loading screens
</verification>

<success_criteria>
- All tasks completed
- validation.js screen exists with 8 category tabs
- SQL query placeholder added with "Coming Soon" label and disabled button
- timeline.js enhanced with snapshot anchors (gold badges) and delta symbols (gray badges)
- Validation screen registered in router with nav link
- CSS styling for placeholders and indicators added
- All screens load without errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-gui-advanced-features/12-02-SUMMARY.md`
</output>
