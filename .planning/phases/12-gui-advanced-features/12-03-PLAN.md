---
phase: 12-gui-advanced-features
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [gui/index.html, gui/js/screens/characters.js]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can visualize character relationships as an interactive graph"
    - "User can see trust, fear, respect, and power balance between characters"
  artifacts:
    - path: "gui/index.html"
      provides: "Loads relationship-map.js component"
      contains: "relationship-map.js"
    - path: "gui/js/screens/characters.js"
      provides: "Relationships tab rendering relationship map"
      exports: ["CharactersScreen"]
  key_links:
    - from: "characters.js"
      to: "RelationshipMap.render()"
      via: "Relationships tab calls component"
      pattern: "RelationshipMap\\.render"
---

<objective>
Wire the orphaned relationship-map.js component to the GUI by loading it in index.html and integrating it into the characters screen as a new "Relationships" tab.

Purpose: Close verification gap - relationship map component exists with all functionality (Vis.js network, color-coded edges, tooltips) but user cannot access it. This plan makes it reachable by adding script loading and screen integration.

Output: Functional relationship map accessible from Characters screen, satisfying GUI-31 and GUI-32 requirements.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Gap context:**
@.planning/phases/12-gui-advanced-features/12-VERIFICATION.md — Gaps identified by verifier
@.planning/phases/12-gui-advanced-features/12-01-SUMMARY.md — Relationship map component already created (304 lines)

**Existing component:**
@gui/js/components/relationship-map.js — Orphaned component to wire
</context>

<tasks>

<task type="auto">
  <name>Task 1: Load relationship-map.js in index.html</name>
  <files>gui/index.html</files>
  <action>
Add script tag loading relationship-map.js in the components section, after other component scripts like arc-card.js, conflict-card.js, setup-payoff-list.js.

Location: Find the script section loading GUI components (after state.js, before screen scripts).

Add: `<script src="/js/components/relationship-map.js"></script>`

Verify Vis.js CDN is already loaded (added in Phase 12-01) - relationship map depends on vis.Network.
  </action>
  <verify>
1. grep "relationship-map.js" gui/index.html shows script tag exists
2. grep "vis-network.min.js" gui/index.html confirms Vis.js CDN loaded
3. Script order: components load before screens
  </verify>
  <done>relationship-map.js loaded via script tag in index.html, after Vis.js CDN and before screen scripts</done>
</task>

<task type="auto">
  <name>Task 2: Add Relationships tab to characters screen</name>
  <files>gui/js/screens/characters.js</files>
  <action>
Enhance characters.js screen with tabbed interface similar to story-logic.js pattern:

1. **Add tab state tracking:**
   - Add `characterTab` to state.js (default: 'list')
   - Options: 'list' (existing character list), 'relationships' (new relationship map)

2. **Modify CharactersScreen.render():**
   - Add tab navigation UI at top (two tabs: "Characters" and "Relationships")
   - Tab click updates state.characterTab and re-renders
   - Conditional rendering based on state.characterTab:
     - 'list': Render existing character list (current behavior)
     - 'relationships': Call `RelationshipMap.render(state.currentFictionId)`

3. **Tab switching logic:**
   - Use same pattern as story-logic.js activeTab
   - Tabs styled with active state highlighting
   - Relationship map fetches data via api.getRelationships(fictionId)

4. **Empty state handling:**
   - If no fiction selected: "Select a fiction to view relationships"
   - If fiction selected but no relationships: "No relationships defined yet"

Reference existing tab pattern from gui/js/screens/story-logic.js for consistency.
  </action>
  <verify>
1. Read gui/js/screens/characters.js - contains tab UI and RelationshipMap.render() call
2. grep "RelationshipMap.render" gui/js/screens/characters.js shows component wired
3. grep "characterTab" gui/js/state.js confirms state field added
4. Visual check: Characters screen has two tabs, Relationships tab renders map
  </verify>
  <done>
Characters screen has tabbed interface with "Characters" and "Relationships" tabs. Relationships tab renders RelationshipMap component. State management tracks active tab. Empty states handled gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 3: Commit gap closure</name>
  <files>gui/index.html, gui/js/screens/characters.js, gui/js/state.js</files>
  <action>
Stage all modified files and commit with format:

```bash
git add gui/index.html gui/js/screens/characters.js gui/js/state.js
git commit -m "$(cat <<'EOF'
feat(12-03): wire relationship map to characters screen

- Load relationship-map.js in index.html
- Add Relationships tab to characters screen
- State tracks characterTab (list/relationships)
- Empty states for no fiction/no relationships

Closes gap: GUI-31, GUI-32 - relationship map now accessible to user

Gap closure for Phase 12 verification
EOF
)"
```

This commit closes the verification gap - relationship map component is now loaded and accessible via Characters → Relationships tab.
  </action>
  <verify>git log -1 --oneline shows "feat(12-03): wire relationship map"</verify>
  <done>Gap closure committed with all file changes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] gui/index.html contains `<script src="/js/components/relationship-map.js"></script>`
- [ ] gui/js/screens/characters.js has tab UI with "Relationships" tab
- [ ] Relationships tab calls RelationshipMap.render(fictionId)
- [ ] state.js tracks characterTab field
- [ ] Commit created with gap closure message
</verification>

<success_criteria>
- All tasks completed
- Relationship map component loaded in HTML
- Characters screen has Relationships tab that renders map
- State management tracks active tab
- Commit confirms gap closure
- Verification gaps from 12-VERIFICATION.md are closed
</success_criteria>

<output>
After completion, create `.planning/phases/12-gui-advanced-features/12-03-SUMMARY.md`
</output>
