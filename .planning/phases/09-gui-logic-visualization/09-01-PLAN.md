---
phase: 09-gui-logic-visualization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - gui/js/screens/story-logic.js
  - gui/js/components/arc-card.js
  - gui/js/components/conflict-card.js
  - gui/js/router.js
  - gui/index.html
autonomous: true

must_haves:
  truths:
    - "User can navigate to Story Logic screen from sidebar"
    - "User can switch between 6 tabs (Arcs, Conflicts, Causality, Themes, Motifs, Setup/Payoffs)"
    - "User can see character arcs with progress visualization"
    - "User can see story conflicts with protagonist/antagonist details"
  artifacts:
    - path: "gui/js/screens/story-logic.js"
      provides: "Story logic screen with tab navigation"
      min_lines: 40
    - path: "gui/js/components/arc-card.js"
      provides: "Character arc display with phase progress"
      min_lines: 30
    - path: "gui/js/components/conflict-card.js"
      provides: "Story conflict display with stakes"
      min_lines: 30
  key_links:
    - from: "story-logic.js"
      to: "api-client methods"
      via: "loads arc and conflict data"
      pattern: "api\\.getCharacterArcs|api\\.getStoryConflicts"
    - from: "arc-card.js"
      to: "arc data"
      via: "receives arc object as parameter"
      pattern: "function.*arcData|renderArc.*arc"
---

<objective>
Create Story Logic screen with tab navigation and display cards for character arcs and story conflicts.

Purpose: Provide users with visual insight into character transformations and story conflicts, fulfilling GUI-07, GUI-08, GUI-09 requirements.

Output: Working Story Logic screen accessible from sidebar, with Arcs and Conflicts tabs functional, ready for additional components in Plan 03.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 8 context - GUI infrastructure
@.planning/phases/08-gui-core-infrastructure/08-01-SUMMARY.md
@.planning/phases/08-gui-core-infrastructure/08-03-SUMMARY.md

# Existing GUI components and patterns
@gui/js/screens/timeline.js
@gui/js/screens/characters.js
@gui/js/state.js
@gui/js/api-client.js
@gui/js/router.js
@gui/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create story-logic.js screen with 6-tab layout</name>
  <files>gui/js/screens/story-logic.js</files>
  <action>
    Create StoryLogicScreen object following existing screen pattern (timeline.js, characters.js).

    Implement render() method with:
    - Screen header with "Story Logic" title and power drawer toggle button
    - Tab navigation bar with 6 tabs: Arcs, Conflicts, Causality, Themes, Motifs, Setup/Payoffs
    - Tab content container that changes based on activeTab state
    - Default to 'arcs' tab on first load

    Use state.get('activeTab') to track current tab. Update state.update({ activeTab: 'conflicts' }) on tab click.

    Tab switching updates content area without full page reload - replace innerHTML of content container.

    Structure:
    - Header with power drawer button (copy from timeline.js pattern)
    - Nav bar with tab buttons (data-tab attribute for click handlers)
    - Content div with id="story-logic-content"
    - Click handler updates activeTab state and calls renderTabContent() helper

    For now, render placeholder text for Causality, Themes, Motifs, Setup/Payoffs tabs (will be filled in Plan 02 and 03).

    For Arcs tab: call api.getCharacterArcs() and render ArcCard for each arc (component created in Task 2).
    For Conflicts tab: call api.getStoryConflicts() and render ConflictCard for each conflict (component created in Task 3).
  </action>
  <verify>
    - story-logic.js file exists with StoryLogicScreen object
    - Screen has render() method
    - Tab navigation renders 6 buttons
    - Clicking tabs updates state.activeTab
  </verify>
  <done>
    Story Logic screen structure complete with tab navigation and content switching
  </done>
</task>

<task type="auto">
  <name>Task 2: Create arc-card.js component for character arc display</name>
  <files>gui/js/components/arc-card.js</files>
  <action>
    Create ArcCard component as global object (not ES6 module - follows Phase 8 pattern).

    Provide render(arcData) method that returns HTML string for character arc display.

    arcData structure (from api.getCharacterArcs()):
    {
      arc_uuid: string,
      character_id: string,
      archetype: string (nullable),
      lie_belief: string (nullable),
      truth_belief: string (nullable),
      want_external: string (nullable),
      need_internal: string (nullable),
      current_phase: string (one of: setup, catalyst, debate, break-into-two, b-story, fun-and-games, midpoint, bad-guys-close-in, all-is-lost, dark-night, break-into-three, finale, final-image)
    }

    Display:
    - Character name (fetch from character_id if needed, or pass as parameter)
    - Archetype badge (if present)
    - Current phase with visual progress bar (13 phases = 13 segments)
    - Lie â†’ Truth transformation display
    - Want vs Need display

    Progress bar: current_phase maps to position in 13-beat structure. Calculate percentage: (phaseIndex / 12) * 100.

    Phase order: setup(0), catalyst(1), debate(2), break-into-two(3), b-story(4), fun-and-games(5), midpoint(6), bad-guys-close-in(7), all-is-lost(8), dark-night(9), break-into-three(10), finale(11), final-image(12).

    Style: card layout with border, padding, shadow. Use CSS variables from main.css (--color-primary, --space-md, etc.).

    Progress bar: div with background color filling percentage width. Example: &lt;div class="progress-bar"&gt;&lt;div class="progress-fill" style="width: 46%"&gt;&lt;/div&gt;&lt;/div&gt;
  </action>
  <verify>
    - arc-card.js file exists with ArcCard object
    - ArcCard.render() returns HTML string
    - Progress bar calculation correct (setup = 0%, finale = 92%, final-image = 100%)
  </verify>
  <done>
    ArcCard component renders character arc with progress visualization
  </done>
</task>

<task type="auto">
  <name>Task 3: Create conflict-card.js component for story conflict display</name>
  <files>gui/js/components/conflict-card.js</files>
  <action>
    Create ConflictCard component as global object following ArcCard pattern.

    Provide render(conflictData) method that returns HTML string.

    conflictData structure (from api.getStoryConflicts()):
    {
      conflict_uuid: string,
      type: string (one of: external, internal, interpersonal, societal, environmental),
      protagonist_id: string,
      antagonist_source: string,
      stakes_success: string,
      stakes_fail: string,
      status: string (one of: latent, active, escalating, climactic, resolved)
    }

    Display:
    - Type badge with color coding:
      - external: blue
      - internal: purple
      - interpersonal: green
      - societal: orange
      - environmental: teal
    - Status badge with color:
      - latent: gray
      - active: yellow
      - escalating: orange
      - climactic: red
      - resolved: green
    - Protagonist vs Antagonist display (use character names if possible, or IDs)
    - Stakes section:
      - "If protagonist succeeds: {stakes_success}"
      - "If protagonist fails: {stakes_fail}"

    Style: card layout similar to ArcCard. Use --color-* variables. Status and type use badge styling (small pill-shaped element with background color).
  </action>
  <verify>
    - conflict-card.js file exists with ConflictCard object
    - ConflictCard.render() returns HTML string
    - Type and status badges have correct color mapping
  </verify>
  <done>
    ConflictCard component renders story conflict with protagonist, antagonist, and stakes
  </done>
</task>

<task type="auto">
  <name>Task 4: Register story-logic route and add sidebar navigation</name>
  <files>gui/js/router.js, gui/index.html</files>
  <action>
    In router.js:
    - Add route registration: router.register('story-logic', StoryLogicScreen)
    - Follows existing pattern from timeline, epistemic, characters routes

    In index.html:
    - Add sidebar navigation link:
      &lt;a href="#story-logic" class="nav-link" data-route="story-logic"&gt;
        &lt;span class="nav-icon"&gt;ðŸ“Š&lt;/span&gt;
        &lt;span class="nav-label"&gt;Story Logic&lt;/span&gt;
      &lt;/a&gt;
    - Insert after characters link, before closing &lt;/nav&gt;
    - Icon: ðŸ“Š (bar chart represents data/structure visualization)

    In index.html script loading section:
    - Add script tags for new components BEFORE app.js:
      &lt;script src="js/components/arc-card.js"&gt;&lt;/script&gt;
      &lt;script src="js/components/conflict-card.js"&gt;&lt;/script&gt;
      &lt;script src="js/screens/story-logic.js"&gt;&lt;/script&gt;
    - Maintain loading order: components â†’ screens â†’ app.js
  </action>
  <verify>
    - router.js includes story-logic route
    - index.html has Story Logic navigation link
    - Script tags added in correct order
    - Clicking sidebar link navigates to #story-logic
  </verify>
  <done>
    Story Logic screen accessible from sidebar navigation, route registered in router
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Navigate to http://localhost:8080/#story-logic and screen loads
- [ ] All 6 tabs visible in navigation bar
- [ ] Clicking tabs switches content (Arcs and Conflicts functional, others show placeholders)
- [ ] Power drawer toggle button present and functional
- [ ] If arcs exist in database, ArcCard components render with progress bars
- [ ] If conflicts exist in database, ConflictCard components render with type/status badges
- [ ] No console errors in browser DevTools
</verification>

<success_criteria>
- All tasks completed
- Story Logic screen registered and accessible
- Tab navigation switches between 6 tabs
- Arcs tab displays character arcs with progress visualization
- Conflicts tab displays story conflicts with stakes
- No errors or warnings introduced
- Ready for Plan 02 (causality graph) and Plan 03 (remaining components)
</success_criteria>

<output>
After completion, create `.planning/phases/09-gui-logic-visualization/09-01-SUMMARY.md`
</output>
