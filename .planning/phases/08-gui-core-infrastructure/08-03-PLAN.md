---
phase: 08-gui-core-infrastructure
plan: 03
type: execute
wave: 3
depends_on: ["08-01", "08-02"]
files_modified:
  - gui/js/screens/timeline.js
  - gui/js/screens/epistemic.js
  - gui/js/screens/characters.js
  - gui/js/app.js
  - gui/js/router.js
  - gui/index.html
autonomous: true

must_haves:
  truths:
    - "User can navigate between timeline, epistemic, and character screens"
    - "Power drawer toggle button appears on each screen"
    - "Layer switcher appears on epistemic screen"
    - "All components initialize without errors"
  artifacts:
    - path: "gui/js/screens/timeline.js"
      provides: "Timeline screen with power drawer toggle"
      exports: ["TimelineScreen"]
      min_lines: 40
    - path: "gui/js/screens/epistemic.js"
      provides: "Epistemic screen with layer switcher and power drawer"
      exports: ["EpistemicScreen"]
      min_lines: 50
    - path: "gui/js/screens/characters.js"
      provides: "Characters screen with power drawer toggle"
      exports: ["CharactersScreen"]
      min_lines: 40
    - path: "gui/js/app.js"
      provides: "Application entry point"
      min_lines: 30
    - path: "gui/js/router.js"
      provides: "Client-side routing"
      exports: ["Router"]
      min_lines: 50
  key_links:
    - from: "timeline.js"
      to: "PowerDrawer.toggle"
      via: "button click handler"
      pattern: "PowerDrawer\\.toggle"
    - from: "epistemic.js"
      to: "LayerSwitcher.init"
      via: "render function call"
      pattern: "LayerSwitcher\\.init"
    - from: "app.js"
      to: "router.js"
      via: "Router.init call"
      pattern: "Router\\.init"
---

<objective>
Wire components to screens and create minimal routing infrastructure.

Purpose: Create stub screens (timeline, epistemic, characters) demonstrating power drawer integration (GUI-02). Add layer switcher to epistemic screen. Build router and app.js to initialize everything. This completes Phase 8 by showing all components working together.

Output: Functioning GUI with 3 navigable screens, each showing power drawer toggle, epistemic screen showing layer switcher, all components initialized properly.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/STRUCTURE.md
@.planning/codebase/CONVENTIONS.md
@.planning/phases/08-gui-core-infrastructure/08-01-SUMMARY.md
@.planning/phases/08-gui-core-infrastructure/08-02-SUMMARY.md

**From Plan 01:**
- GUI structure exists (index.html, directories)
- api-client.js available

**From Plan 02:**
- state.js with pub/sub available
- PowerDrawer component with init/toggle methods
- LayerSwitcher component with init/setMode methods

**Requirement GUI-02:** Power drawer integrates with timeline, epistemic, and character screens (toggle button on each)

**Screen layout pattern:**
Each screen should have:
- Header with title and power drawer toggle button
- Layer switcher container (epistemic screen only)
- Content area (placeholder for Phase 9+ features)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create router.js for client-side routing</name>
  <files>gui/js/router.js</files>
  <action>
    Create gui/js/router.js using hash-based routing:

    **Structure:**
    ```javascript
    const Router = {
      routes: new Map(),
      currentRoute: null,

      register(path, screen) {
        // path: string like 'timeline', 'epistemic', 'characters'
        // screen: object with render() method
        this.routes.set(path, screen);
      },

      init() {
        // Set up hash change listener
        window.addEventListener('hashchange', () => {
          this.navigate(window.location.hash.slice(1) || 'timeline');
        });

        // Navigate to initial route
        const initialRoute = window.location.hash.slice(1) || 'timeline';
        this.navigate(initialRoute);
      },

      navigate(path) {
        const screen = this.routes.get(path);
        if (!screen) {
          console.error(`Route not found: ${path}`);
          return;
        }

        this.currentRoute = path;

        // Clear current content
        const app = document.getElementById('app');
        app.innerHTML = '';

        // Render new screen
        screen.render();

        // Update navigation active state
        document.querySelectorAll('.nav-link').forEach(link => {
          link.classList.toggle('active', link.dataset.route === path);
        });
      }
    };
    ```

    **Conventions:**
    - Hash-based routing (#timeline, #epistemic, #characters)
    - Routes registered before init()
    - navigate() clears #app and calls screen.render()
  </action>
  <verify>
    - File exists: ls gui/js/router.js
    - Has Router object: grep -q "const Router" gui/js/router.js
    - Has register/init/navigate methods: grep -c "register\|init\|navigate" gui/js/router.js
    - Syntax valid: node --check gui/js/router.js
  </verify>
  <done>router.js created with hash-based routing, register/init/navigate methods</done>
</task>

<task type="auto">
  <name>Task 2: Create stub screens with power drawer integration</name>
  <files>gui/js/screens/timeline.js, gui/js/screens/epistemic.js, gui/js/screens/characters.js</files>
  <action>
    Create three stub screens demonstrating component integration:

    **gui/js/screens/timeline.js:**
    ```javascript
    const TimelineScreen = {
      render() {
        const app = document.getElementById('app');
        app.innerHTML = `
          <div class="screen timeline-screen">
            <header class="screen-header">
              <h1>Timeline</h1>
              <button class="btn btn-icon" onclick="PowerDrawer.toggle()" title="Open Power Drawer">
                <span>üîç</span>
              </button>
            </header>
            <div class="screen-content">
              <p>Timeline visualization will be implemented in Phase 11.</p>
              <p>Current view mode: <strong id="view-mode-display">${state.get('viewMode')}</strong></p>
            </div>
          </div>
        `;

        // Subscribe to viewMode changes to update display
        state.subscribe('viewMode', (mode) => {
          const display = document.getElementById('view-mode-display');
          if (display) display.textContent = mode;
        });
      }
    };
    ```

    **gui/js/screens/epistemic.js:**
    ```javascript
    const EpistemicScreen = {
      render() {
        const app = document.getElementById('app');
        app.innerHTML = `
          <div class="screen epistemic-screen">
            <header class="screen-header">
              <h1>Epistemic States</h1>
              <button class="btn btn-icon" onclick="PowerDrawer.toggle()" title="Open Power Drawer">
                <span>üîç</span>
              </button>
            </header>
            <div id="layer-switcher-container"></div>
            <div class="screen-content">
              <p>Epistemic graph and knowledge tracking will be implemented in Phase 11.</p>
              <p>Current view mode: <strong id="view-mode-display">${state.get('viewMode')}</strong></p>
            </div>
          </div>
        `;

        // Initialize layer switcher
        LayerSwitcher.init('layer-switcher-container');

        // Subscribe to viewMode changes
        state.subscribe('viewMode', (mode) => {
          const display = document.getElementById('view-mode-display');
          if (display) display.textContent = mode;
        });
      }
    };
    ```

    **gui/js/screens/characters.js:**
    ```javascript
    const CharactersScreen = {
      render() {
        const app = document.getElementById('app');
        app.innerHTML = `
          <div class="screen characters-screen">
            <header class="screen-header">
              <h1>Characters</h1>
              <button class="btn btn-icon" onclick="PowerDrawer.toggle()" title="Open Power Drawer">
                <span>üîç</span>
              </button>
            </header>
            <div class="screen-content">
              <p>Character management and arc tracking will be implemented in Phase 11.</p>
            </div>
          </div>
        `;
      }
    };
    ```

    **Requirements:**
    - GUI-02: Power drawer toggle button on each screen ‚úì
    - Layer switcher only on epistemic screen (will expand in Phase 11)
  </action>
  <verify>
    - Files exist: ls gui/js/screens/timeline.js gui/js/screens/epistemic.js gui/js/screens/characters.js
    - Timeline has PowerDrawer.toggle: grep -q "PowerDrawer.toggle" gui/js/screens/timeline.js
    - Epistemic has LayerSwitcher.init: grep -q "LayerSwitcher.init" gui/js/screens/epistemic.js
    - Characters has PowerDrawer.toggle: grep -q "PowerDrawer.toggle" gui/js/screens/characters.js
    - All syntax valid: node --check gui/js/screens/*.js
  </verify>
  <done>Three stub screens created, each with power drawer toggle, epistemic screen has layer switcher</done>
</task>

<task type="auto">
  <name>Task 3: Create app.js and wire everything together</name>
  <files>gui/js/app.js, gui/index.html, gui/styles/components.css</files>
  <action>
    Create gui/js/app.js as entry point:

    **app.js:**
    ```javascript
    // Application entry point
    // Initializes all components and starts router

    document.addEventListener('DOMContentLoaded', () => {
      console.log('TripleThink v4.1 - Initializing...');

      // Initialize components
      PowerDrawer.init();

      // Register routes
      Router.register('timeline', TimelineScreen);
      Router.register('epistemic', EpistemicScreen);
      Router.register('characters', CharactersScreen);

      // Start router
      Router.init();

      console.log('TripleThink v4.1 - Ready');
    });
    ```

    **Update gui/index.html with navigation and script loading:**
    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>TripleThink v4.1</title>
      <link rel="stylesheet" href="/styles/main.css">
      <link rel="stylesheet" href="/styles/components.css">
    </head>
    <body>
      <nav class="sidebar">
        <h2>TripleThink</h2>
        <ul>
          <li><a href="#timeline" class="nav-link" data-route="timeline">Timeline</a></li>
          <li><a href="#epistemic" class="nav-link" data-route="epistemic">Epistemic</a></li>
          <li><a href="#characters" class="nav-link" data-route="characters">Characters</a></li>
        </ul>
      </nav>

      <main>
        <div id="app">
          <!-- Screen content rendered here -->
        </div>
      </main>

      <!-- Load scripts in dependency order -->
      <script src="/js/state.js"></script>
      <script src="/js/api-client.js"></script>
      <script src="/js/components/power-drawer.js"></script>
      <script src="/js/components/layer-switcher.js"></script>
      <script src="/js/screens/timeline.js"></script>
      <script src="/js/screens/epistemic.js"></script>
      <script src="/js/screens/characters.js"></script>
      <script src="/js/router.js"></script>
      <script src="/js/app.js"></script>
    </body>
    </html>
    ```

    **Add layout CSS to gui/styles/components.css:**
    ```css
    /* Layout */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 200px;
      background: #2c3e50;
      color: #fff;
      padding: 1rem;
    }

    .sidebar h2 {
      margin: 0 0 1rem 0;
      font-size: 1.2rem;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar li {
      margin-bottom: 0.5rem;
    }

    .nav-link {
      color: #ecf0f1;
      text-decoration: none;
      padding: 0.5rem;
      display: block;
      border-radius: 4px;
      transition: background 0.2s ease;
    }

    .nav-link:hover {
      background: #34495e;
    }

    .nav-link.active {
      background: #3498db;
    }

    main {
      flex: 1;
      overflow-y: auto;
    }

    .screen {
      padding: 2rem;
    }

    .screen-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #ddd;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
    }

    .btn-icon {
      padding: 0.5rem;
      font-size: 1.2rem;
      background: #f5f5f5;
      border: 1px solid #ddd;
    }

    .btn-icon:hover {
      background: #e8e8e8;
    }
    ```
  </action>
  <verify>
    - app.js exists: ls gui/js/app.js
    - app.js initializes components: grep -q "PowerDrawer.init\|Router.init" gui/js/app.js
    - app.js registers routes: grep -c "Router.register" gui/js/app.js (should be 3)
    - index.html has navigation: grep -q "nav-link" gui/index.html
    - index.html loads all scripts: grep -c "<script src" gui/index.html (should be 9)
    - Layout CSS exists: grep -q ".sidebar\|.screen" gui/styles/components.css
    - All syntax valid: node --check gui/js/app.js
  </verify>
  <done>app.js created and wires all components, index.html updated with navigation and script loading, layout CSS added</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] router.js has register/init/navigate methods
- [ ] Three screens exist (timeline, epistemic, characters)
- [ ] Each screen has power drawer toggle button
- [ ] Epistemic screen has layer switcher
- [ ] app.js initializes PowerDrawer and Router
- [ ] index.html has navigation and loads all scripts
- [ ] Layout CSS provides sidebar and main content area
- [ ] Can serve GUI and navigate between screens
- [ ] No console errors when loading GUI
</verification>

<success_criteria>
- All tasks completed
- GUI serves on port 8080 without errors
- User can navigate between timeline, epistemic, characters screens
- Power drawer can toggle open/closed from any screen
- Layer switcher on epistemic screen changes viewMode
- All requirements GUI-01 through GUI-06 satisfied
- Ready for Phase 9 (story logic visualization)
</success_criteria>

<output>
After completion, create `.planning/phases/08-gui-core-infrastructure/08-03-SUMMARY.md`
</output>
