---
phase: 08-gui-core-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - gui/index.html
  - gui/js/api-client.js
  - gui/package.json
autonomous: true

must_haves:
  truths:
    - "GUI loads in browser without errors"
    - "API client can call all logic layer endpoints"
  artifacts:
    - path: "gui/index.html"
      provides: "SPA shell with script loading"
      min_lines: 30
    - path: "gui/js/api-client.js"
      provides: "API communication layer"
      exports: ["APIClient"]
      min_lines: 100
  key_links:
    - from: "gui/index.html"
      to: "gui/js/api-client.js"
      via: "script tag inclusion"
      pattern: "<script.*api-client\\.js"
    - from: "gui/js/api-client.js"
      to: "/api/logic/*"
      via: "fetch calls"
      pattern: "fetch.*\\/api\\/logic"
---

<objective>
Establish GUI foundation and API communication layer for v4.1 logic layer features.

Purpose: Create base structure (HTML shell, directories) and complete API client with methods for all 7 logic layer modules (causality chains, character arcs, story conflicts, thematic elements, motif instances, setup/payoffs, world rules).

Output: Working GUI skeleton that loads without errors and can communicate with all API endpoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STACK.md
@.planning/codebase/STRUCTURE.md
@.planning/codebase/CONVENTIONS.md
@.planning/phases/07-api-layer/07-01-SUMMARY.md
@.planning/phases/07-api-layer/07-02-SUMMARY.md

**Phase 7 context:**
- All logic layer REST endpoints exist in api/routes/logic-layer.js
- 43 total endpoints across causality, arcs, conflicts, themes, motifs, setups, rules
- Standard RESTful patterns: GET /:id, GET /, POST /, PUT /:id, DELETE /:id
- Specialized endpoints: GET /causality/chain/:eventId, GET /setup-payoffs/unfired, etc.

**Tech stack:**
- Vanilla JavaScript (no frameworks - see PROJECT.md constraint)
- API on port 3000, GUI on port 8080
- D3.js and vis.js for future visualizations (Phase 9+)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create base GUI structure</name>
  <files>gui/index.html, gui/package.json, gui/js/, gui/styles/, gui/assets/</files>
  <action>
    1. Create directory structure: gui/js/, gui/js/components/, gui/js/screens/, gui/js/utils/, gui/styles/, gui/assets/
    2. Create gui/index.html as SPA shell with:
       - DOCTYPE html5
       - head: meta charset, viewport, title "TripleThink v4.1", stylesheet links
       - body: div#app as root, script tags for future components
       - Script loading order: utils → api-client → state → components → screens → app
    3. Create gui/package.json (if needed for serve) with name, version, scripts to serve on port 8080
    4. Create placeholder gui/styles/main.css with CSS reset and design tokens

    Follow conventions: vanilla JS (no build step), kebab-case filenames, 2-space indent.
  </action>
  <verify>
    - Directory structure exists: ls gui/js/components gui/js/screens gui/js/utils gui/styles
    - index.html is valid HTML5: grep -q "<!DOCTYPE html>" gui/index.html
    - Can serve GUI: cd gui && npx serve -p 8080 (in background), curl http://localhost:8080
  </verify>
  <done>GUI directory structure created, index.html loads without errors, serves on port 8080</done>
</task>

<task type="auto">
  <name>Task 2: Create api-client.js with all logic layer endpoints</name>
  <files>gui/js/api-client.js</files>
  <action>
    Create gui/js/api-client.js as API communication layer:

    **Structure:**
    ```javascript
    class APIClient {
      constructor(baseURL = 'http://localhost:3000') {
        this.baseURL = baseURL;
      }

      async request(endpoint, options = {}) {
        // Generic request method with error handling
        // Returns response.data or throws error
      }

      // Core Data Endpoints (from Phase 7 Plan 01)
      async getCausalityChain(eventId, depth = 3) { /* GET /api/logic/causality/chain/:eventId?depth=N */ }
      async getCausalityChains(projectId) { /* GET /api/logic/causality?project_id=X */ }
      async createCausalityChain(data) { /* POST /api/logic/causality */ }
      async updateCausalityChain(id, data) { /* PUT /api/logic/causality/:id */ }
      async deleteCausalityChain(id) { /* DELETE /api/logic/causality/:id */ }

      async getCharacterArcs(projectId) { /* GET /api/logic/arcs?project_id=X */ }
      async getCharacterArc(id) { /* GET /api/logic/arcs/:id */ }
      async createCharacterArc(data) { /* POST /api/logic/arcs */ }
      async updateCharacterArc(id, data) { /* PUT /api/logic/arcs/:id */ }
      async advanceArcPhase(id) { /* POST /api/logic/arcs/:id/advance */ }
      async deleteCharacterArc(id) { /* DELETE /api/logic/arcs/:id */ }

      async getStoryConflicts(projectId) { /* GET /api/logic/conflicts?project_id=X */ }
      async getStoryConflict(id) { /* GET /api/logic/conflicts/:id */ }
      async createStoryConflict(data) { /* POST /api/logic/conflicts */ }
      async updateStoryConflict(id, data) { /* PUT /api/logic/conflicts/:id */ }
      async transitionConflictStatus(id, newStatus) { /* POST /api/logic/conflicts/:id/transition */ }
      async deleteStoryConflict(id) { /* DELETE /api/logic/conflicts/:id */ }

      // Themes, Motifs, Setups, Rules (from Phase 7 Plan 02)
      async getThematicElements(projectId) { /* GET /api/logic/themes?project_id=X */ }
      async getThematicElement(id) { /* GET /api/logic/themes/:id */ }
      async createThematicElement(data) { /* POST /api/logic/themes */ }
      async updateThematicElement(id, data) { /* PUT /api/logic/themes/:id */ }
      async addManifestation(id, manifestation) { /* POST /api/logic/themes/:id/manifestations */ }
      async removeManifestation(id, index) { /* DELETE /api/logic/themes/:id/manifestations/:index */ }
      async deleteThematicElement(id) { /* DELETE /api/logic/themes/:id */ }

      async getMotifInstances(projectId, motifType = null) { /* GET /api/logic/motifs?project_id=X&motif_type=Y */ }
      async getMotifInstance(id) { /* GET /api/logic/motifs/:id */ }
      async createMotifInstance(data) { /* POST /api/logic/motifs */ }
      async updateMotifInstance(id, data) { /* PUT /api/logic/motifs/:id */ }
      async deleteMotifInstance(id) { /* DELETE /api/logic/motifs/:id */ }

      async getSetupPayoffs(projectId) { /* GET /api/logic/setup-payoffs?project_id=X */ }
      async getUnfiredSetups(projectId) { /* GET /api/logic/setup-payoffs/unfired?project_id=X */ }
      async getSetupPayoff(id) { /* GET /api/logic/setup-payoffs/:id */ }
      async createSetupPayoff(data) { /* POST /api/logic/setup-payoffs */ }
      async fireSetup(id, payoffEventId, firedChapter) { /* POST /api/logic/setup-payoffs/:id/fire */ }
      async updateSetupPayoff(id, data) { /* PUT /api/logic/setup-payoffs/:id */ }
      async deleteSetupPayoff(id) { /* DELETE /api/logic/setup-payoffs/:id */ }

      async getWorldRules(projectId, ruleCategory = null) { /* GET /api/logic/world-rules?project_id=X&rule_category=Y */ }
      async getWorldRule(id) { /* GET /api/logic/world-rules/:id */ }
      async createWorldRule(data) { /* POST /api/logic/world-rules */ }
      async updateWorldRule(id, data) { /* PUT /api/logic/world-rules/:id */ }
      async deleteWorldRule(id) { /* DELETE /api/logic/world-rules/:id */ }
    }

    // Export singleton instance
    const api = new APIClient();
    ```

    **Error handling:**
    - request() method catches fetch errors
    - Throws descriptive errors with status codes
    - Returns response.data on success

    **Conventions:**
    - camelCase method names (Phase 7 uses snake_case in API, convert here)
    - Async/await throughout
    - Optional parameters with defaults (depth=3, motifType=null, ruleCategory=null)
  </action>
  <verify>
    - File exists: ls gui/js/api-client.js
    - Contains APIClient class: grep -q "class APIClient" gui/js/api-client.js
    - Has all 7 module endpoint groups: grep -c "async get.*Arc\|Conflict\|Theme\|Motif\|Setup\|Rule\|Causality" gui/js/api-client.js (should be >30)
    - Exports singleton: grep -q "const api = new APIClient" gui/js/api-client.js
    - Syntax valid: node --check gui/js/api-client.js
  </verify>
  <done>api-client.js exists with methods for all 43 logic layer endpoints, singleton exported, no syntax errors</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] GUI directory structure exists (js/components, js/screens, js/utils, styles, assets)
- [ ] index.html is valid HTML5 and loads without errors
- [ ] GUI can be served on port 8080
- [ ] api-client.js contains APIClient class with >30 methods
- [ ] api-client.js exports singleton `api` instance
- [ ] No JavaScript syntax errors
</verification>

<success_criteria>
- All tasks completed
- GUI skeleton loads in browser without console errors
- API client can be instantiated and has methods for all logic layer endpoints
- Directory structure matches conventions (STRUCTURE.md)
- Code follows naming conventions (CONVENTIONS.md)
</success_criteria>

<output>
After completion, create `.planning/phases/08-gui-core-infrastructure/08-01-SUMMARY.md`
</output>
